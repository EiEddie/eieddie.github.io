<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Windows 下的现代 C/C&#43;&#43; 开发环境配置# 首先应该确保电脑上有这些必需的软件:
CMake Ninja vcpkg MSVC 套件 MSVC 安装# 可以使用 Visual Studio 安装工具 针对性地安装 MSVC 套件而不必安装全套 Visual Studio .
只需在下载的 Visual Studio Installer 中选择 单个组件 → 编译器、生成工具和运行时 → MSVC vXXX - VS 2022 C&#43;&#43; x64/x86 生成工具 选项进行安装. 建议安装最新版本.
MSVC 环境必须经过初始化才可以使用. 安装完成后会自动出现 Developer Command Prompt for VS 20xx (即 开发人员命令提示符 ) 和 Developer PowerShell for VS 20xx (即 开发人员 PowerShell ), 这两个终端就是已经初始化的环境, 在这两个终端中可以直接调用编译器. 另外 Visual Studio 还提供了初始化脚本来初始化编译器环境.
vcpkg 安装# 访问 vcpkg 的 GitHub 仓库以查看安装说明.
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://example.org/docs/vscode-cmake-with-msvc/">
  <meta property="og:site_name" content="EiEddie&#39;s Mind">
  <meta property="og:title" content="Windows 下的现代 C/C&#43;&#43; 开发环境配置">
  <meta property="og:description" content="Windows 下的现代 C/C&#43;&#43; 开发环境配置# 首先应该确保电脑上有这些必需的软件:
CMake Ninja vcpkg MSVC 套件 MSVC 安装# 可以使用 Visual Studio 安装工具 针对性地安装 MSVC 套件而不必安装全套 Visual Studio .
只需在下载的 Visual Studio Installer 中选择 单个组件 → 编译器、生成工具和运行时 → MSVC vXXX - VS 2022 C&#43;&#43; x64/x86 生成工具 选项进行安装. 建议安装最新版本.
MSVC 环境必须经过初始化才可以使用. 安装完成后会自动出现 Developer Command Prompt for VS 20xx (即 开发人员命令提示符 ) 和 Developer PowerShell for VS 20xx (即 开发人员 PowerShell ), 这两个终端就是已经初始化的环境, 在这两个终端中可以直接调用编译器. 另外 Visual Studio 还提供了初始化脚本来初始化编译器环境.
vcpkg 安装# 访问 vcpkg 的 GitHub 仓库以查看安装说明.">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2024-09-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-20T00:00:00+00:00">
    <meta property="article:tag" content="折腾">
    <meta property="article:tag" content="开发环境">


  <meta itemprop="name" content="Windows 下的现代 C/C&#43;&#43; 开发环境配置">
  <meta itemprop="description" content="Windows 下的现代 C/C&#43;&#43; 开发环境配置# 首先应该确保电脑上有这些必需的软件:
CMake Ninja vcpkg MSVC 套件 MSVC 安装# 可以使用 Visual Studio 安装工具 针对性地安装 MSVC 套件而不必安装全套 Visual Studio .
只需在下载的 Visual Studio Installer 中选择 单个组件 → 编译器、生成工具和运行时 → MSVC vXXX - VS 2022 C&#43;&#43; x64/x86 生成工具 选项进行安装. 建议安装最新版本.
MSVC 环境必须经过初始化才可以使用. 安装完成后会自动出现 Developer Command Prompt for VS 20xx (即 开发人员命令提示符 ) 和 Developer PowerShell for VS 20xx (即 开发人员 PowerShell ), 这两个终端就是已经初始化的环境, 在这两个终端中可以直接调用编译器. 另外 Visual Studio 还提供了初始化脚本来初始化编译器环境.
vcpkg 安装# 访问 vcpkg 的 GitHub 仓库以查看安装说明.">
  <meta itemprop="datePublished" content="2024-09-20T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-09-20T00:00:00+00:00">
  <meta itemprop="wordCount" content="605">
  <meta itemprop="keywords" content="折腾,开发环境">

<title>Windows 下的现代 C/C&#43;&#43; 开发环境配置 | EiEddie&#39;s Mind</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://example.org/docs/vscode-cmake-with-msvc/">
<link rel="stylesheet" href="/book.min.da13678e0f8d7d2b749f4c561f5f2f27b57defeb2b27e506235b21dcd411be4a.css" integrity="sha256-2hNnjg&#43;NfSt0n0xWH18vJ7V97&#43;srJ&#43;UGI1sh3NQRvko=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.9777f4c6ce2f46dd477a055b2f0f1c99767b90dd82fbd40a2f5edac4aac408ef.js" integrity="sha256-l3f0xs4vRt1HegVbLw8cmXZ7kN2C&#43;9QKL17axKrECO8=" crossorigin="anonymous"></script>



  


<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']],
      displayMath: [['$$', '$$']]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"
  async>
</script>



</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>EiEddie&#39;s Mind</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/article-processing-pipeline/" class="">
      文章处理管线</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hugo-with-math/" class="">
      为 Hugo 添加数学支持</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/static-site-with-hugo/" class="">
      使用 Hugo 搭建静态站点</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/calc-with-unit/" class="">
      带有单位的物理计算</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/qm-angular-momentum/" class="">
      量子力学中的角动量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/jordan-normal-form/" class="">
      若尔当标准型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/commutative-lt/" class="">
      可交换的线性变换</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dynamic-simulation-of-density-fluids/" class="">
      密度流体的动态模拟</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/long-time-ago-a-essay/" class="">
      从中科大回来的时候我母亲就预言了我的今天</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/esp32-dev/" class="">
      ESP32 环境配置与开发</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mahony-complementary-filter/" class="">
      Mahony 非线性互补滤波器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/async-serial/" class="">
      异步非阻塞串口数据接收</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/rigid-movement/" class="">
      三维空间中刚体运动的描述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/rigid-rotation/" class="">
      三维空间中旋转的描述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/time-series-forecasting-using-taylor/" class="">
      使用泰勒展开的运动预测</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ballistics/" class="">
      抛体运动弹道解算</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/conventional-commits/" class="">
      约定式提交</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git-submodule/" class="">
      `git` 子模块</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/repo-struct/" class="">
      关于知识库框架结构的一些想法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git-tips/" class="">
      Git Tips</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/vscode-cmake-with-msvc/" class="active">
      Windows 下的现代 C/C&#43;&#43; 开发环境配置</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux-to-go/" class="">
      在移动介质中安装操作系统</a>
  

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Windows 下的现代 C/C&#43;&#43; 开发环境配置</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#msvc-安装">MSVC 安装</a></li>
    <li><a href="#vcpkg-安装">vcpkg 安装</a></li>
    <li><a href="#ninja-安装">Ninja 安装</a></li>
    <li><a href="#vs-code-配置">VS Code 配置</a></li>
    <li><a href="#构建过程">构建过程</a></li>
    <li><a href="#示例">示例</a>
      <ul>
        <li><a href="#安装-opencv">安装 OpenCV</a></li>
        <li><a href="#编写-cmakeliststxt">编写 <code>CMakeLists.txt</code></a></li>
        <li><a href="#源代码">源代码</a></li>
        <li><a href="#构建项目">构建项目</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="windows-下的现代-cc-开发环境配置">Windows 下的现代 C/C++ 开发环境配置<a class="anchor" href="#windows-%e4%b8%8b%e7%9a%84%e7%8e%b0%e4%bb%a3-cc-%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae">#</a></h1>
<p>首先应该确保电脑上有这些必需的软件:</p>
<ul>
<li>CMake</li>
<li>Ninja</li>
<li>vcpkg</li>
<li>MSVC 套件</li>
</ul>
<h2 id="msvc-安装">MSVC 安装<a class="anchor" href="#msvc-%e5%ae%89%e8%a3%85">#</a></h2>
<p>可以使用 <a href="https://visualstudio.microsoft.com/zh-hans/downloads/"><em>Visual Studio 安装工具</em></a> 针对性地安装 MSVC 套件而不必安装全套 Visual Studio .</p>
<p>只需在下载的 Visual Studio Installer 中选择 <strong>单个组件 → 编译器、生成工具和运行时 → MSVC vXXX - VS 2022 C++ x64/x86 生成工具</strong> 选项进行安装. 建议安装最新版本.</p>
<p>MSVC 环境必须经过初始化才可以使用. 安装完成后会自动出现 <em>Developer Command Prompt for VS 20xx</em> (即 <em>开发人员命令提示符</em> ) 和 <em>Developer PowerShell for VS 20xx</em> (即 <em>开发人员 PowerShell</em> ), 这两个终端就是已经初始化的环境, 在这两个终端中可以直接调用编译器. 另外 Visual Studio 还提供了初始化脚本来初始化编译器环境.</p>
<h2 id="vcpkg-安装">vcpkg 安装<a class="anchor" href="#vcpkg-%e5%ae%89%e8%a3%85">#</a></h2>
<p>访问 vcpkg 的 GitHub 仓库以查看安装说明.</p>
<p>将仓库克隆到本地后, 需要将可执行文件添加到 <code>PATH</code> 环境变量中, 并声明 <code>VCPKG_ROOT</code> 环境变量. 我个人的做法是为可执行文件创建符号链接, 就像 Linux 中创建链接到 <code>/usr/local/bin</code> 一样. 声明 <code>VCPKG_ROOT</code> 变量并将值定义为你克隆仓库目录的绝对地址, 这样 vcpkg 才在终端环境中可用.</p>
<h2 id="ninja-安装">Ninja 安装<a class="anchor" href="#ninja-%e5%ae%89%e8%a3%85">#</a></h2>
<p>Ninja 是一个跨平台的构建系统, 我们使用它来作为 CMake 的生成器. 安装它的方式很简单, 在 GitHub 仓库下载最新版本后放到 <code>PATH</code> 环境变量中的文件夹即可.</p>
<h2 id="vs-code-配置">VS Code 配置<a class="anchor" href="#vs-code-%e9%85%8d%e7%bd%ae">#</a></h2>
<p>为了与 CMake 配合, 这些扩展是必须的:</p>
<ul>
<li><strong>C/C++</strong></li>
<li><strong>CMake</strong></li>
<li><strong>CMake Tools</strong></li>
</ul>
<p>另外, 为了获得更完备的开发体验, 建议使用 <strong>clangd</strong> 替代 <strong>C/C++</strong> 作为代码静态分析和补全的后端. 但 <strong>C/C++</strong> 也得保留, 为了与 CMake 有关插件配合. 我们可以把 <strong>C/C++</strong> 的所有代码提示全部关掉, 防止与 <strong>clangd</strong> 冲突.</p>
<p><strong>clangd</strong> 需要配置才能识别引入的第三方库, 否则就会报 <code>file not found</code> 错误. 可以读取通过 CMake 自动生成的 <code>compile_commands.json</code> 文件来配置第三方库信息. 然而 CMake 只能为 Ninja 和 Makefile 生成此文件<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. 因为我们想尽可能做到跨平台, 所以使用 Ninja 是更好的选择.</p>
<p>在项目的根目录下放置一个 <code>CMakePresets.json</code> 可以控制 VS Code 中 CMake 的配置行为, 各种命令行参数也可以在这里面定义. 下面是一个示例文件, 定义了四个可选的项目配置预设:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;configurePresets&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;vcpkg&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 隐藏此配置
</span></span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;hidden&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 引入 vcpkg 包管理
</span></span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_TOOLCHAIN_FILE&#34;</span>: <span style="color:#e6db74">&#34;$env{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;inherits&#34;</span>: <span style="color:#e6db74">&#34;vcpkg&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;hidden&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 指定生成器为 Ninja
</span></span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;generator&#34;</span>: <span style="color:#e6db74">&#34;Ninja&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#75715e">// 输出文件到项目目录下的 build/debug 文件夹
</span></span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;binaryDir&#34;</span>: <span style="color:#e6db74">&#34;${sourceDir}/build/debug&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_BUILD_TYPE&#34;</span>: <span style="color:#e6db74">&#34;Debug&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 生成 compile_commands.json 文件
</span></span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_EXPORT_COMPILE_COMMANDS&#34;</span>: <span style="color:#e6db74">&#34;True&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;release&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;inherits&#34;</span>: <span style="color:#e6db74">&#34;vcpkg&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;hidden&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;generator&#34;</span>: <span style="color:#e6db74">&#34;Ninja&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#75715e">// 输出文件到项目目录下的 build/release 文件夹
</span></span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;binaryDir&#34;</span>: <span style="color:#e6db74">&#34;${sourceDir}/build/release&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_BUILD_TYPE&#34;</span>: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;windows-debug-x86_64-msvc&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;inherits&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;displayName&#34;</span>: <span style="color:#e6db74">&#34;Windows x86_64 MSVC (Debug)&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;MSVC with vcpkg for Windows x86_64 - Debug Configuration&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 指定使用 MSVC 编译套件
</span></span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_C_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;cl&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_CXX_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;cl&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;windows-release-x86_64-msvc&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;inherits&#34;</span>: <span style="color:#e6db74">&#34;release&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;displayName&#34;</span>: <span style="color:#e6db74">&#34;Windows x86_64 MSVC (Release)&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;MSVC with vcpkg for Windows x86_64 - Release Configuration&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 指定使用 MSVC 编译套件
</span></span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_C_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;cl&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_CXX_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;cl&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;windows-debug-x86_64-mingw&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;inherits&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;displayName&#34;</span>: <span style="color:#e6db74">&#34;Windows x86_64 MinGW (Debug)&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;MinGW with vcpkg for Windows x86_64 - Debug Configuration&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 指定使用 GUN gcc 编译套件, 来自 MinGW
</span></span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_C_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;cc&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_CXX_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;c++&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;windows-release-x86_64-mingw&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;inherits&#34;</span>: <span style="color:#e6db74">&#34;release&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;displayName&#34;</span>: <span style="color:#e6db74">&#34;Windows x86_64 MinGW (Release)&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;MinGW with vcpkg for Windows x86_64 - Release Configuration&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cacheVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 指定使用 GUN gcc 编译套件, 来自 MinGW
</span></span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_C_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;cc&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CMAKE_CXX_COMPILER&#34;</span>: <span style="color:#e6db74">&#34;c++&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><strong>CMake Tools</strong> 自带一个复制 <code>compile_commands.json</code> 到指定位置的功能. 如果这个指定的位置恰好是文件默认所处的位置, 就会出现错误, 这一点应当注意. 我们可以把生成在 <code>build/debug</code> 的文件复制到 <code>build</code> 文件夹, 以确保一致性. 在 <code>.vscode/settings.json</code> 中添加下面一句来启用这一项功能:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;cmake.copyCompileCommands&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;${workspaceFolder}/build/compile_commands.json&#34;</span></span></span></code></pre></div><p>然后配置 <strong>clangd</strong> 让它能够找到此文件. 在 <code>.vscode/settings.json</code> 下添加这样一句来向 <strong>clangd</strong> 指明文件位置:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;clangd.arguments&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;--compile-commands-dir=build&#34;</span>]</span></span></code></pre></div><p>现在这一套组合应该已经可用了.</p>
<h2 id="构建过程">构建过程<a class="anchor" href="#%e6%9e%84%e5%bb%ba%e8%bf%87%e7%a8%8b">#</a></h2>
<p>当你点击 <em>全部构建</em> 时发生了什么? 最终的二进制文件是怎么编译出来的?</p>
<p>我们在上面定义了一套比较复杂的调用关系, 具体就是:</p>
<pre><code>cmake → ninja → cl (MSVC)
</code></pre>
<p>当你想要获得最终的编译成果时, 实际上会发生以下步骤:</p>
<ol>
<li>配置 Configure<br>
这一步 <code>cmake</code> 会读取 <code>CMakePresets.json</code> 文件中的内容, 综合我们的要求解析 <code>CMakeLists.txt</code> 输出一个编译文件, 在使用 Ninja 作为生成器时输出的是 <code>build.ninja</code>, 在 <code>build</code> 文件夹中.</li>
<li>构建 Build<br>
这一步 <code>cmake</code> 会调用指定的生成器 (<code>ninja</code>), 逐条按照编译文件执行指令; 生成器会负责调用指定的编译器按指令进行编译.</li>
<li>编译与链接 Compile &amp; Link<br>
生成器 <code>ninja</code> 会调用编译器与链接器, 先将源代码文件编译成中间文件 <code>.obj</code> / <code>.o</code> , 而后与外部库进行链接, 输出最终的二进制文件. 如果有动态链接库, 也会被复制过来.</li>
</ol>
<p>另外, <em>配置</em> 时会产生 <code>compile_commands.json</code> 文件, 然后 <strong>clangd</strong> 才能读取进而提供静态分析和代码补全. 所以想用 <strong>clangd</strong> 的功能时, 必须得先 <em>配置</em> 一遍才行.</p>
<h2 id="示例">示例<a class="anchor" href="#%e7%a4%ba%e4%be%8b">#</a></h2>
<p>我们来实际编译一个简单的 OpenCV 项目来验证上述设置都是否正确.</p>
<blockquote class='book-hint warning'>
<p>必须初始化 MSVC 环境后才能调用它的编译套件.</p>
<p>可以在开发人员 <em>命令提示符中</em> 输入 <code>code &lt;path&gt;</code> 命令打开 VS Code 后进行操作.</p></blockquote><h3 id="安装-opencv">安装 OpenCV<a class="anchor" href="#%e5%ae%89%e8%a3%85-opencv">#</a></h3>
<p>使用 vcpkg 来安装, 只需使用命令:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vcpkg install opencv</span></span></code></pre></div><p>然后 vcpkg 就会自动安装所有依赖项, 并在本地编译.</p>
<p>因为我们是在 Windows 环境中, 所以库的三元组为 <code>x64-windows</code> , 这也是 Windows 上的默认值.</p>
<h3 id="编写-cmakeliststxt">编写 <code>CMakeLists.txt</code><a class="anchor" href="#%e7%bc%96%e5%86%99-cmakeliststxt">#</a></h3>
<p>项目根目录下应该存在一个 <code>CMakeLists.txt</code> 来指定构建选项. 下面是一个示例:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># CMakeLists.txt
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>cmake_minimum_required(<span style="color:#e6db74">VERSION</span> <span style="color:#e6db74">3.10</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>project(<span style="color:#e6db74">&#34;test-opencv&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># 搜索依赖的 OpenCV 库
</span></span></span><span style="display:flex;"><span>find_package(<span style="color:#e6db74">&#34;OpenCV&#34;</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>add_executable(<span style="color:#e6db74">&#34;test&#34;</span> <span style="color:#e6db74">&#34;src/main.cpp&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>target_link_libraries(<span style="color:#e6db74">&#34;test&#34;</span> <span style="color:#e6db74">PRIVATE</span> <span style="color:#f92672">${</span>OpenCV_LIBS<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># 不要用 vcpkg 给出的下面的设置, 会出现链接错误
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>target_link_libraries(<span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#e6db74">PRIVATE</span> <span style="color:#e6db74">opencv_ml</span> <span style="color:#e6db74">opencv_dnn</span> <span style="color:#e6db74">opencv_core</span> <span style="color:#e6db74">opencv_flann</span>)</span></span></code></pre></div><h3 id="源代码">源代码<a class="anchor" href="#%e6%ba%90%e4%bb%a3%e7%a0%81">#</a></h3>
<p>我们来写一个打印 OpenCV 版本的小程序来验证是否正常安装依赖:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// src/main.cpp
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;opencv2/opencv.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstdio&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>printf(<span style="color:#e6db74">&#34;OpenCV version: &#34;</span> CV_VERSION <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h3 id="构建项目">构建项目<a class="anchor" href="#%e6%9e%84%e5%bb%ba%e9%a1%b9%e7%9b%ae">#</a></h3>
<p>先来检查一下项目结构:</p>
<pre><code>.
├─ .vscode
│   └─ settings.json
├─ src
│   └─ main.cpp
├─ CMakeLists.txt
└─ CMakePresets.json
</code></pre>
<p>之后进行构建, 使用 <code>Windows x86_64 MSVC (Debug)</code> 预设, 应该能在 <code>build/debug</code> 目录里找到 <code>text.exe</code> , 运行它会打印一行 OpenCV 的版本信息.</p>
<p>构建一遍以后再修改源代码, 应该可以享受到 <strong>clangd</strong> 的代码分析和补全了.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_EXPORT_COMPILE_COMMANDS.html">https://cmake.org/cmake/help/latest/variable/CMAKE_EXPORT_COMPILE_COMMANDS.html</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article>
 
      




  <div class="flex flex-wrap justify-between">
    <div class="flex align-center text-sm text-muted">
      
      <span class="overline" style="font-style:italic;">Last updated: September 20, 2024</span>
    </div>
  </div>




      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/docs/git-tips/" class="flex align-center">
        <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>Git Tips</span>
      </a>
    
    </span>
    <span>
    
      <a href="/docs/linux-to-go/" class="flex align-center">
        <span>在移动介质中安装操作系统</span>
        <img src="/icons/forward.svg" class="book-icon" alt="Forward" />
      </a>
    
    </span>
  </div>
  


 
        
  
  <div class="book-comments">

</div>
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#msvc-安装">MSVC 安装</a></li>
    <li><a href="#vcpkg-安装">vcpkg 安装</a></li>
    <li><a href="#ninja-安装">Ninja 安装</a></li>
    <li><a href="#vs-code-配置">VS Code 配置</a></li>
    <li><a href="#构建过程">构建过程</a></li>
    <li><a href="#示例">示例</a>
      <ul>
        <li><a href="#安装-opencv">安装 OpenCV</a></li>
        <li><a href="#编写-cmakeliststxt">编写 <code>CMakeLists.txt</code></a></li>
        <li><a href="#源代码">源代码</a></li>
        <li><a href="#构建项目">构建项目</a></li>
      </ul>
    </li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















